<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Blog Network</title>
<style>
body {
  margin:0; font-family:Arial,sans-serif;
  background:#f0f4ff url('https://www.transparenttextures.com/patterns/tileable-wood-print.png') repeat;
  color:#000080; user-select:none;
}
header {
  background:linear-gradient(90deg,#3399ff,#9966ff);
  padding:20px 30px; box-shadow:0 3px 6px rgba(0,0,0,0.3);
  display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap;
}
.logo-container { display:flex; align-items:center; gap:10px; }
.logo { font-size:36px; color:#fff; font-weight:bold; }
.tagline { font-size:18px; color:#ffe066; font-style:italic; font-weight:bold; text-shadow:1px 1px 0 #000033; }
nav { display:flex; gap:10px; align-items:center; margin-top:10px; flex-wrap:wrap; }
button.filter-btn {
  background:#ffcc00; border:2px solid #000080; border-radius:3px;
  padding:8px 14px; font-weight:bold; font-size:12px; cursor:pointer;
  color:#000080; box-shadow:1px 1px 0 #333; transition:background 0.2s; user-select:none;
}
button.filter-btn:hover { background:#ffff66; }
button.filter-btn.active { background:#ffff99; border-color:#330066; box-shadow:2px 2px 4px #660099; }
main {
  max-width:700px; margin:25px auto; padding:10px 20px;
  background:#ffffffcc; border:3px solid #3399ff;
  box-shadow:0 4px 10px rgba(0,0,0,0.2); border-radius:6px; min-height:300px;
}
form#post-form {
  max-width:700px; margin:0 auto 25px auto; background:#ffffffcc;
  padding:15px 20px; border:3px solid #9966ff; border-radius:6px;
  box-shadow:0 4px 8px rgba(153,102,255,0.5); display:flex; flex-direction:column;
}
input#username, textarea#post-content {
  width:100%; padding:8px; font-size:14px; border:2px solid #9966ff; border-radius:4px;
}
textarea#post-content { min-height:60px; resize:vertical; }
button#submit-post {
  margin-top:8px; background:#9966ff; border:none;
  padding:8px 16px; color:white; font-weight:bold;
  border-radius:4px; cursor:pointer; align-self:flex-end; transition:background 0.3s;
}
button#submit-post:hover { background:#7a3fcc; }
.post {
  border:2px inset #99ccff; background:#e6f0ff; padding:15px; margin-bottom:20px;
  font-size:13px; font-family:'Courier New', monospace;
  box-shadow:1px 1px 0 #99ccff; display:flex; align-items:center; gap:10px;
}
.post img { width:40px; height:40px; border-radius:50%; object-fit:cover; }
.post-content { display:flex; flex-direction:column; }
footer { text-align:center; margin:20px auto; font-size:12px; font-family:'Courier New', monospace; color:#333; }
</style>
</head>
<body>

<header>
  <div class="logo-container">
    <div class="logo">THE BLOG NETWORK</div>
    <div class="tagline">Chat with others!</div>
  </div>
  <nav>
    <div style="display:flex; gap:10px; align-items:center;">
      <button class="filter-btn active" data-filter="friends">Friends</button>
      <button class="filter-btn" data-filter="unseen">Unseen</button>
      <button class="filter-btn" data-filter="public">Public</button>
    </div>
    <a href="profile.html"><button id="profile-btn" title="Your Profile">ðŸ‘¤</button></a>
  </nav>
</header>

<form id="post-form">
  <input type="text" id="username" placeholder="Your username" />
  <textarea id="post-content" placeholder="Write your post here..."></textarea>
  <button type="submit" id="submit-post">Post</button>
</form>

<main id="feed"></main>

<footer>
  <em>EST. 2025 CREATED BY CHRISTIAN (RUPPEEY) DUNLAP & JOHN (PRINCE HERB) NORTON</em>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey:"AIzaSyBGNJwqrVv4lMPBTXiwwhv81cxCrIYF6V0",
  authDomain:"the-blog-network.firebaseapp.com",
  projectId:"the-blog-network",
  storageBucket:"the-blog-network.appspot.com",
  messagingSenderId:"857847462134",
  appId:"1:857847462134:web:a22e9a6467a230632b94d7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const buttons = document.querySelectorAll('.filter-btn');
const feed = document.getElementById('feed');
const form = document.getElementById('post-form');
const textarea = document.getElementById('post-content');
const usernameInput = document.getElementById('username');
let currentFilter = 'friends';

// Load username from localStorage
if(localStorage.getItem('username')) usernameInput.value = localStorage.getItem('username');

// Bad words filter
const badWords=['nigger','retard','shit','nigga','fuck','bitch','bastard','crap','douche','dick','cunt','cock','pussy','tits','dickhead','slut','whore','motherfucker'];
function sanitizeText(text){let s=text;badWords.forEach(w=>{s=s.replace(new RegExp(`\\b${w}\\b`,'gi'),'****')});return s;}

// Format timestamps
function formatTimestamp(date){
  const now=new Date();
  const diffMs=now-date;
  const diffMins=Math.floor(diffMs/60000);
  if(diffMins<1) return 'just now';
  if(diffMins===1) return '1 minute ago';
  if(diffMins<60) return `${diffMins} minutes ago`;
  const diffHrs=Math.floor(diffMins/60);
  if(diffHrs===1) return '1 hour ago';
  if(diffHrs<24) return `${diffHrs} hours ago`;
  const diffDays=Math.floor(diffHrs/24);
  if(diffDays===1) return '1 day ago';
  return `${diffDays} days ago`;
}

// Handle filter buttons
buttons.forEach(btn => {
  btn.addEventListener('click', ()=>{
    buttons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter = btn.getAttribute('data-filter');
    filterPosts(currentFilter);
  });
});

function filterPosts(filter){
  const posts = feed.querySelectorAll('.post');
  posts.forEach(post => post.getAttribute('data-type') === filter || filter === 'public' ? post.style.display='flex' : post.style.display='none');
}

// Cache for user profiles
const userCache = {};

// Render posts
async function renderPosts(snapshot){
  feed.innerHTML='';
  const postDocs = snapshot.docs;
  const missingUsers = [];

  postDocs.forEach(doc=>{
    const data = doc.data();
    if(data.authorId && !userCache[data.authorId] && !missingUsers.includes(data.authorId)) missingUsers.push(data.authorId);
  });

  if(missingUsers.length > 0){
    const usersSnap = await db.collection('users').where(firebase.firestore.FieldPath.documentId(), 'in', missingUsers).get();
    usersSnap.forEach(u=>userCache[u.id]=u.data());
  }

  postDocs.forEach(doc=>{
    const post = doc.data();
    const authorId = post.authorId || 'friend_alpha';
    const userData = userCache[authorId] || { username: authorId, avatarURL: 'https://via.placeholder.com/40' };
    const article = document.createElement('article');
    article.className='post';
    article.setAttribute('data-type', post.type || 'friends');
    article.innerHTML=`
      <img src="${userData.avatarURL}" alt="avatar">
      <div class="post-content">
        <div class="author">${userData.username}</div>
        <div class="timestamp">${post.timestamp?formatTimestamp(post.timestamp.toDate()):''}</div>
        <div class="content">${post.content}</div>
      </div>
    `;
    feed.appendChild(article);
  });

  filterPosts(currentFilter);
}

// Listen for post changes
db.collection('posts').orderBy('timestamp','desc').onSnapshot(renderPosts);

form.addEventListener('submit', async e => {
  e.preventDefault();
  const content = textarea.value.trim();
  const username = usernameInput.value.trim() || 'friend_alpha';
  if (!content) return alert('Please write something before posting!');

  // Save username locally
  localStorage.setItem('username', username);
  const avatarURL = localStorage.getItem('avatarURL') || 'https://via.placeholder.com/40';

  try {
    // Ensure user exists first
    await db.collection('users').doc(username).set({ username, avatarURL }, { merge: true });

    // Add post after user is confirmed
  db.collection('posts').add({
  authorId: username,
  content: sanitizeText(content),
  timestamp: firebase.firestore.FieldValue.serverTimestamp(),
  type: currentFilter,
  key: "MY_SECRET_KEY" // must match your rules
});


    textarea.value = ''; // clear textarea
  } catch(err) {
    alert('Error posting: ' + err.message);
  }
});

</script>
</body>
</html>


